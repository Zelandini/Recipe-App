{% extends "base.html" %}

{% block title %}
  {% if form_type == "login" %}
    Login ‚Ä¢ CS235 Recipe Portal
  {% else %}
    Register ‚Ä¢ CS235 Recipe Portal
  {% endif %}
{% endblock %}

{% block content %}
<div class="container">
  <section class="hero hero--auth">
    {% if form_type == "login" %}
      <h1 class="hero-title">Welcome Back</h1>
      <p class="hero-sub lead">Sign in to your Recipe Portal account</p>
    {% else %}
      <h1 class="hero-title">Join Recipe Portal</h1>
      <p class="hero-sub lead">Create your account to save and share recipes</p>
    {% endif %}

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="form-messages">
          {% for category, message in messages %}
            <div class="pill {% if category == 'error' %}flash-message--error{% else %}flash-message--success{% endif %}">
              <span>{% if category == "error" %}‚ö†Ô∏è{% else %}‚úÖ{% endif %}</span>
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Custom error messages -->
    {% if user_name_error_message %}
      <div class="pill flash-message--error">
        <span>‚ö†Ô∏è</span>
        {{ user_name_error_message }}
      </div>
    {% endif %}

    {% if password_error_message %}
      <div class="pill flash-message--error">
        <span>‚ö†Ô∏è</span>
        {{ password_error_message }}
      </div>
    {% endif %}

    <div class="form-container">
      <form method="POST" novalidate>
        {{ form.hidden_tag() }}

        <div class="form-field">
          <label for="{{ form.username.id }}" class="form-label">{{ form.username.label.text }}</label>
          {{ form.username(class_="form-input" + (" form-input--error" if form.username.errors or user_name_error_message else "")) }}
          {% if form.username.errors %}
            {% for error in form.username.errors %}
              <div class="form-error">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>

        <div class="form-field">
          <label for="{{ form.password.id }}" class="form-label">{{ form.password.label.text }}</label>
          {{ form.password(class_="form-input" + (" form-input--error" if form.password.errors or password_error_message else "")) }}
          {% if form.password.errors %}
            {% for error in form.password.errors %}
              <div class="form-error">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>

        {% if form_type == "register" %}
        <div class="form-field">
          <label for="{{ form.confirm.id }}" class="form-label">{{ form.confirm.label.text }}</label>
          {{ form.confirm(class_="form-input" + (" form-input--error" if form.confirm.errors else "")) }}
          {% if form.confirm.errors %}
            {% for error in form.confirm.errors %}
              <div class="form-error">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>
        {% endif %}

        <div class="form-field">
          {{ form.submit(class_="form-submit") }}
        </div>
      </form>

      <div class="auth-toggle">
        {% if form_type == "login" %}
          <p class="muted">Don't have an account?
            <a href="{{ url_for('authentication_bp.register') }}" class="login-link">Sign up here</a>
          </p>
        {% else %}
          <p class="muted">Already have an account?
            <a href="{{ url_for('authentication_bp.login') }}" class="login-link">Sign in here</a>
          </p>
        {% endif %}
      </div>
    </div>
  </section>

  {% if form_type == "register" %}
  <section class="section">
    <div class="card card--centered">
      <h2>Why Join Recipe Portal?</h2>
      <div class="features-grid">
        <div class="feature">
          <div class="feature-icon">üìö</div>
          <h3>Save Recipes</h3>
          <p class="muted small">Keep your favorite recipes organized and accessible</p>
        </div>
        <div class="feature">
          <div class="feature-icon">üë®‚Äçüç≥</div>
          <h3>Share Creations</h3>
          <p class="muted small">Upload your own recipes and inspire others</p>
        </div>
        <div class="feature">
          <div class="feature-icon">‚≠ê</div>
          <h3>Rate & Review</h3>
          <p class="muted small">Help the community discover the best dishes</p>
        </div>
      </div>
    </div>
  </section>
  {% endif %}
</div>
{% endblock %}